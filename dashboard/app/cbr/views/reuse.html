<ul class="nav nav-tabs">
  <li role="presentation"><a class="btn btn-link" ng-click="$state.go('cbr.retrieve')"><i class="fas fa-search-plus"></i> Retrieve</a></li>
  <li role="presentation" class="active"><a class="btn btn-link"><i class="fas fa-redo"></i> Reuse</a></li>
  <li role="presentation"><a class="btn btn-link" ng-click="reviseCase()"><i class="fas fa-edit"></i> Revise</a></li>
  <li role="presentation"><a class="btn btn-link" ng-click="retainCase()"><i class="fas fa-plus"></i> Retain</a></li>
</ul>

<p></p>

<div class="row">
  <p>Retrieve time: {{ requests.response.retrieveTime | number:3 }}s | ES Query time: {{ requests.response.esTime | number:3 }}ms</p>
  <button type="button" class="btn btn-primary" title="Download Query Results" ng-click="exportResults()" ng-disabled="!requests.response.bestK>0">
    Download Results
  </button>
</div>

<div class="row">
  <!-- Display recommended solution -->
  <div class="row" ng-show="objOrArrayHasContent(requests.response.recommended)">
    <h4 align="center">Recommendation</h4>
    <div class="col-lg-12">
      <div class="p-5">
        <form id="reviseForm">
          <div class="table-responsive">
            <table class="table table-striped table-bordered" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <th ng-repeat="(key, value) in requests.response.recommended">{{ key }}</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td ng-repeat="(key, value) in requests.response.recommended">
                    <span ng-if=" getDataType(value)!='object' ">{{ value }}</span>
                    <code ng-if=" getDataType(value)=='object' ">
                      <pre>{{ value | json }}</pre>
                    </code>
                  </td>
                  <td>
                    <button type="button" class="btn btn-default" ng-click="reviseCase()">
                      Revise
                    </button>
                    <button type="button" class="btn btn-primary" ng-click="retainCase()">
                      Retain
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="row" ng-show="!objOrArrayHasContent(requests.response.recommended)">
    <p>   The query values are too restrictive, or there are no cases in the casebase, or the retrieve step not was completed.</p>
  </div>
</div>

<div class="row">
  <!-- Display most similar cases -->
  <div class="row" ng-show="objOrArrayHasContent(requests.response.bestK)">
    <h4 align="center">Most similar cases</h4>
    <div class="col-lg-12">
      <div class="p-5">
        <form id="reuseForm">
          <div class="table-responsive">
            <table class="table table-striped table-bordered" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <th ng-repeat="attrib in selected.attributes">{{ attrib.name }}</th>
                  <th>Score</th>
                  <th ng-if="requests.current.explanation">Local similarity measures</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="entry in requests.response.bestK">
                  <td ng-repeat="attrib in selected.attributes" ng-if="entry">
                    <span ng-if=" getDataType(entry[attrib.name])!='object' ">{{ entry[attrib.name] }}</span>
                    <code ng-if=" getDataType(entry[attrib.name])=='object' ">
                      <pre>{{ entry[attrib.name] | json }}</pre>
                    </code>
                  </td>
                  <td>
                    {{ entry['score__'] | number:3 }}
                  </td>
                  <td ng-if="entry.match_explanation">
                    <code>
                      <pre>{{ entry['match_explanation'] | json }}</pre>
                    </code>
                  </td>
                  <td>
                    <button type="button" class="btn btn-block btn-primary" ng-click="reuseCase(entry)">
                      Reuse
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
